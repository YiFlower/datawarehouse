# datawarehouse
## 数据来源与数据说明

### 数据来源

数据来源阿里云天池，由飞猪提供。该数据集是用户脱敏行为数据，包括基本属性用户和商品基本属性的脱敏信息。

数据链接：https://tianchi.aliyun.com/dataset/dataDetail?dataId=113649

### 数据说明

数据包含三部分，分别为用户历史行为脱敏数据、用户基础属性脱敏数据以及商品基础属性脱敏数据。

| 文件名称                       | 说明                       | 包含特征                                     |
| ------------------------------ | -------------------------- | -------------------------------------------- |
| user_item_behavior_history.csv | 包含所有的用户行为数据     | 用户ID，商品ID，行为类型，时间戳             |
| user_profile.csv               | 包含所有的用户基础属性画像 | 用户ID，年龄，性别、职业、常居城市、人群标签 |
| item_profile.csv               | 包含所有的商品基础属性画像 | 商品ID，商品类目ID，商品城市，商品标签       |

**user_item_behavior_history.csv**

本数据文件包含了2019年6月3日至2021年6月3日，随机抽取的约200多万用户的所有行为（行为包括点击、收藏、加购、购买），数据集的组织形式和MovieLens-20M类似，即数据集的每一行表示一条用户行为，由用户ID、商品ID、行为类型和时间戳组成，并以英文逗号分隔。关于数据集中每一列的详细描述如下：

| 列名称   | 说明                                                |
| -------- | --------------------------------------------------- |
| 用户ID   | 整数类型，序列化后的用户ID                          |
| 商品ID   | 整数类型，序列化后的商品ID                          |
| 行为类型 | 字符串，枚举类型，包括('clk', 'fav', 'cart', 'pay') |
| 时间戳   | 整数类型，行为发生的时间戳                          |

**user_profile.csv**

本数据文件主要包含了约二百万随机用户的基础属性特征，比如年龄、性别、职业、常居城市ID、人群标签等，数据集的每一行表示一条用户信息，并以英文逗号分隔。关于数据集中每一列的详细描述如下：

| 列名称   | 说明                                     |
| -------- | ---------------------------------------- |
| 用户ID   | 整数类型，序列化后的用户ID               |
| 年龄     | 整数类型，序列化后的年龄ID               |
| 性别     | 整数类型，序列化后性别ID                 |
| 职业     | 整数类型，序列化后职业ID                 |
| 常居城市 | 整数类型，序列化后城市ID                 |
| 人群标签 | 字符串，每个标签序列化后ID用英文分号分割 |

**item_profile.csv**

本数据文件主要包含了约27万商品的基础属性特征，比如商品类目ID，商品城市，商品标签等，数据集的每一行表示一条商品的信息，并以逗号分隔。关于数据集中每一列的详细描述如下：

| 列名称     | 说明说明                                 |
| ---------- | ---------------------------------------- |
| 商品ID     | 整数类型，序列化后的商品ID               |
| 商品类目ID | 整数类型，序列化后的商品类目ID           |
| 商品城市   | 整数类型，序列化后的商品城市ID           |
| 商品标签   | 字符串，每个标签序列化后ID用英文分号分割 |

关于数据集大小的一些说明如下：

| 维度           | 数量     |
| -------------- | -------- |
| 用户数量       | 5744057  |
| 商品数量       | 267326   |
| 类目数量       | 115      |
| 城市数量       | 341      |
| 用户人群标签   | 12       |
| 商品玩法标签   | 208      |
| 用商品交互数量 | 22516238 |

## 一、离线数仓

### （一）需求描述

#### 1. 报表需求

平台经过长期发展，积累了大量客户行为数据与客户维度、商品维度数据 。 为了掌握平台发展情况，故对平台数据提炼分析，获取以下报表指标：

- 活跃用户比例
- 用户性别比例
- 月增长用户数
- 业务新开展城市
- 销售数量环比

#### 2. 数据分析

平台经过长期发展，积累了大量客户行为数据与客户维度、商品维度数据 。 为了分析客户的行为，挖掘潜在需求，故对平台数据提炼分析，获取以下分析指标：

- 点击与购买转化比
- 热销商品Top10
- 活跃用户Top10
- 优质客户Top10
- 被购买商品数量最多的城市Top5

### （二）设计概述

#### 1. 业务架构设计

![1651321814775](C:\Users\Y1Flower\AppData\Local\Temp\1651321814775.png)



#### 2. 数据流程设计

![1651321823172](C:\Users\Y1Flower\AppData\Local\Temp\1651321823172.png)



#### 3. 命名设计

##### （1）表名命名设计

表名由以下组成：

**数据所属层级**：ODS、DWD、DWS等；

**主题域**：根据主题域命名，如订单、用户、商品等；

**表内涵**：表数据内容描述；

**维度/事实**：维度使用DIM表示，事实使用FACT表示；

**加载方式**：D：每天，M：月，Y：年，一次性加载不作区分；

**增/全量**：增量使用I，全量使用H。

数据所属层级、主题域、表内涵、维度/事实、加载方式之间使用下划线连接，加载方式、增/全量之间不做分割。如ods_user_behavior_fact_di，表示每天增量同步的用户行为表，ods_user_dim_dh，表示每天同步全量的用户维度表。

##### （2）程序命名设计

程序名由以下组成：

**程序作用层级**：ODS、DWD、DWS等；

**程序功能**：extract：抽取、transform：转换、load：加载 ；

**程序语言**：Java、Scala、Shell等；

**调度频率**：D：每天，M：月，Y：年；

**是否需要参数**：Y：是，N：否；

**程序编号**：三位，从001开始；

程序作用层级、程序功能、程序语言之间使用下划线连接，调度频率、是否需要参数之间不做分割。如ods_extract_shell_dy_001，表示抽取到ODS层的Shell脚本程序，每天运行一次，需要传入参数；dwd_transform_scala_dn_001，表示转换到DWD层的Scala语言程序，每天运行一次，不需要参数。

来源表、目标表、程序入参、调度说明等，需要编写到程序的注释说明中，并同步到数仓管理中。

#### 4. 维度/事实划分

事实涉及来自业务过程的度量，基本都以数量值表示。一个事实表行与粒度存在一对一关系；维度表是事实表不可或缺的组成部分。维度表包含业务过程度量事件有关的文本环境。他用来描述与"谁、什么、哪里、何时、如何、为什么"有关的事件。维度/事实划分需要结合主题域划分，主题域划分方式有四种：

- 按照所属系统划分：业务系统有几种，就划分几个主题域；
- 按照业务（功能模块/业务线）或业务过程划分。比如一个靠销售广告位置的门户网站主题域可能会有广告域，客户域等，而广告域可能就会有广告的库存，销售分析、内部投放分析等主题； 
- 按照部门划分主题域。比如公司里面的人力、财务、销售、运营等，运营域中可能会有工资支出分析、活动宣传效果分析等主题；
- 按照行业案例分析划分主题域。比如电信、金融都是最早建设数仓的行业，都有一些规范，比如IBM 公司的 BDWM 九大金融主题模型，Teradata 公司的 FS-LDM 十大金融主题模型，都是行业应用比较广泛的标准，这两个行业就可以参考构建自己的企业数据仓库模型规范。 

划分主题域后，以主题域内实体的每一个动作为一个事实，划分事实表；实体的属性或描述动作的属性划分为维度表。

本次Demo按照业务划分，分为用户行为主题，主题内分为用户行为事实表、用户维度表、商品维度表。

### （三）项目开发

#### 1. 数据落盘





#### 2. ODS层开发





#### 3. DWD层开发





#### 4. DWS层开发





#### 5. APP层开发





#### 6. 报表开发





#### 7. 调度开发





### （四）数仓管理

#### 1. 元数据管理

##### （1）表元数据管理



##### （2）数仓映射管理



##### （3）数仓程序管理





#### 2. 数仓权限管理





## 二、实时数仓与Lambda架构

</>



## 三、数据湖与流批一体

</>



